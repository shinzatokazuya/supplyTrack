<!doctype html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8"/>
    <title>Campi</title>
    <link rel="stylesheet" href="../css/styles.css"></head>
<body>
    <header>
        <h1>Campi</h1>
        <nav>
            <a href="index.html">Voltar</a>
        </nav>
    </header>

    <main class="container">
    <form id="form-campi"><input type="hidden" id="campi-id">
        <label>Nome:
            <input id="campi-nome" required>
        </label>
        <label>Cidade:
            <input id="campi-cidade" required>
        </label>
        <label>Estado:
            <input id="campi-estado" required>
        </label>
        <label>UF:
            <input id="campi-uf" required>
        </label>
        <div class="actions">
            <button>Salvar</button>
            <button type="button" id="reset" class="secondary">Limpar</button>
        </div>
    </form>

    <h2>Lista</h2>
    <table id="tbl-campi"><thead><tr><th>ID</th><th>Nome</th><th>Cidade</th><th>Estado</th><th>UF</th><th>Ações</th></tr></thead><tbody></tbody></table>
    </main>
    <script src="api.js"></script>
    <script>
    async function carregar(){
    const rows = await apiGet('/campi'); const t=document.querySelector('#tbl-campi tbody'); t.innerHTML='';
    rows.forEach(r=> t.innerHTML += `<tr><td>${r.ID}</td><td>${r.nome}</td><td>${r.cidade}</td><td>${r.estado}</td><td>${r.uf}</td>
        <td class="actions"><button onclick="editar(${r.ID})" class="small">Editar</button><button onclick="excluir(${r.ID})" class="small secondary">Excluir</button></td></tr>`);
    }
    async function editar(id){ const r=await apiGet('/campi/'+id); document.getElementById('campi-id').value=r.ID; document.getElementById('campi-nome').value=r.nome; document.getElementById('campi-cidade').value=r.cidade; document.getElementById('campi-estado').value=r.estado; document.getElementById('campi-uf').value=r.uf; }
    async function excluir(id){ if(!confirm('Excluir?')) return; await apiDelete('/campi/'+id); carregar(); }
    document.getElementById('form-campi').addEventListener('submit', async e=>{ e.preventDefault(); const id=document.getElementById('campi-id').value; const body={nome:document.getElementById('campi-nome').value,cidade:document.getElementById('campi-cidade').value,estado:document.getElementById('campi-estado').value,uf:document.getElementById('campi-uf').value}; if(id) await apiPut('/campi/'+id,body); else await apiPost('/campi',body); document.getElementById('reset').click(); carregar();});
    document.getElementById('reset').addEventListener('click', ()=>{ document.getElementById('form-campi').reset(); document.getElementById('campi-id').value='';});
    window.addEventListener('load', carregar);
    </script>
</body>
</html>
